import{r as m,y as w,j as e,Y as M}from"./app-CZojdjD4.js";import{I as p}from"./inputtext.esm-Bc9dGI99.js";import{B as k}from"./button.esm-Cv2vqUD6.js";import{A as I}from"./AuthenticatedLayout-B_5TWh4u.js";import{D as E}from"./dropdown.esm-C3w7lM7_.js";import{B as H}from"./blockui.esm-CT455C9i.js";import{u as K}from"./formik.esm-C2ZluvBh.js";import{T as U}from"./toast.esm-Ci78TIq9.js";import{A as T,a as F}from"./accordion.esm-BkzqJAze.js";import{I as Y}from"./inputnumber.esm-BkIM76z1.js";import{I as $}from"./inputtextarea.esm-oIyypEZZ.js";import{I as X}from"./image.esm-BxHawxpu.js";import{P as G}from"./progressbar.esm-Bu0LTKJp.js";import"./iconbase.esm-DvODm2qg.js";import"./ripple.esm-ByfALGiA.js";import"./ApplicationLogo-C3VFVwyk.js";import"./transition-Bl2-vqQL.js";import"./virtualscroller.esm-aVvJseNT.js";import"./csstransition.esm-BI2IUjb-.js";import"./overlayservice.esm-0R6tr4hB.js";import"./index.esm-BypTRDCm.js";import"./index.esm-D-5U2K2D.js";import"./TransitionGroup-_qrsneQI.js";import"./index.esm-Bh2Rs3JK.js";const ge=({auth:R,csrf_token:A,prepareds:b,packageData:i})=>{const[c,O]=m.useState(!1),n=m.useRef(null),[u,f]=m.useState(!1),[z,j]=m.useState(0),[g,N]=m.useState(null),{values:a,handleChange:C,handleSubmit:P,handleBlur:B,setFieldValue:x,errors:J,dirty:_}=K({initialValues:{note:"",quantity:1,files:[],prepared:b[0]},onSubmit:async s=>{let l=0,r=new FormData;r.append("quantity",s.quantity),r.append("note",s.note),r.append("prepared",s.prepared.name);for(let t=0;t<s.files.length;t++)s.files[t].type.includes("image")?(r.append("images[]",s.files[t]),l++):s.files[t].type.includes("video")&&(r.append("videos[]",s.files[t]),l++);if(!(s.quantity>0)){n.current.show({severity:"warn",summary:"Hata",detail:"Koli Adedi En Az 1 Olmalıdır."});return}if(l===0){n.current.show({severity:"warn",summary:"Hata",detail:"Lütfen En Az Bir Adet Resim Veya Video Seçiniz."});return}f(!0);let o=Date.now(),d=new XMLHttpRequest;d.open("POST",route("packages.store",i.id),!0),d.setRequestHeader("X-CSRF-TOKEN",A),d.upload.onprogress=function(t){if(t.lengthComputable){let y=t.loaded/t.total*100;j(Math.floor(y));let h=(Date.now()-o)/1e3,V=t.loaded/h,S=(t.total-t.loaded)/V,q=Math.floor(S/60),L=Math.floor(S%60);N(`${q}dk ${L}sn`)}},d.onload=function(){f(!1);let t=JSON.parse(d.responseText),{status:y,message:h}=t;j(0),N(null),y?(O(!0),n.current.show({severity:"success",summary:"Başarılı",detail:h}),setTimeout(()=>{w.visit(route("packages.index"))},1500)):n.current.show({severity:"error",summary:"Hata",detail:h})},d.onerror=function(){f(!1),n.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})},d.send(r)}}),v=m.useRef(null);return e.jsxs(I,{user:R.user,header:"Paket Verilerini Ekle",info:[{icon:"pi-user",text:i.name+" ("+i.phone+")"},{icon:"pi-calendar",text:new Date(i.created_at).toLocaleString()},{icon:"pi-desktop",text:i.officer+" (Kayıt Personeli)"}],buttons:[{icon:"pi pi-arrow-left",tooltip:"Bekleyen Paketleri Görüntüle",tooltipOptions:{position:"bottom"},size:"small",severity:"secondary",onClick:()=>{w.visit(route("packages.index"))}}],children:[e.jsx(M,{title:"Paket Ekle"}),e.jsx(U,{ref:n}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-[90rem] mx-auto sm:px-6 lg:px-8",children:[e.jsx("div",{className:!u&&"hidden",children:e.jsx(G,{color:"var(--green-500)",value:z,displayValueTemplate:s=>e.jsxs(e.Fragment,{children:[s,"% ",s>95&&"Dosyalar Yüklendi İşlem Yapılıyor"]})})}),e.jsx("div",{className:"mb-3 "+(!u&&" hidden"),children:g&&e.jsxs("div",{className:"text-sm text-gray-500 text-end",children:["Kalan Tahmini Süre : ",g]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg",children:e.jsx(H,{blocked:u,template:e.jsx("i",{className:"pi pi-spin pi-spinner",style:{fontSize:"3rem"}}),children:e.jsxs("form",{onSubmit:P,className:"p-6 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"p-fluid",children:[e.jsx(T,{className:"mb-3",children:e.jsx(F,{header:"Müşteri Bilgileri ("+i.name+")",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"font-bold",children:["Müşteri Adı ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(p,{id:"name",type:"text",name:"name",value:i.name,readOnly:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"phone",className:"font-bold",children:["Müşteri Telefonu ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(p,{id:"phone",type:"tel",name:"phone",value:i.phone,readOnly:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"city",className:"font-bold",children:["Müşteri İl ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(p,{id:"city",type:"text",name:"city",value:i.city,readOnly:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"district",className:"font-bold",children:["Müşteri İlçe ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(p,{id:"district",type:"text",name:"district",value:i.district,readOnly:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"address",className:"font-bold",children:["Müşteri Adresi ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(p,{id:"address",type:"text",name:"address",value:i.address,readOnly:!0})]})]})})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"quantity",className:"font-bold",children:["Paket Adedi ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(Y,{id:"quantity",type:"text",min:1,name:"quantity",suffix:" Koli",value:a.quantity,onChange:s=>{x("quantity",s.value)}})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(k,{label:a.files.length>0?`${a.files.length} Adet Medya Seçili`:"Resim Ve Videoları Seçin",disabled:c,icon:"pi pi-image",type:"button",severity:a.files.length>0?"success":"info",onClick:()=>{v.current.click()}}),e.jsx("input",{type:"file",name:"files",disabled:c,id:"files",onChange:s=>{let l=s.target.files,r=[];for(let o=0;o<l.length;o++)(l[o].type.includes("image")||l[o].type.includes("video"))&&r.push(l[o]);r.length===0&&n.current.show({severity:"warn",summary:"Hata",detail:"Lütfen Sadece Resim Veya Video Dosyaları Seçiniz."}),x("files",r)},accept:"image/*,video/*",style:{display:"none"},multiple:!0,ref:v})]}),e.jsx(T,{className:"mb-3",hidden:!a.files.length>0,children:e.jsx(F,{header:"Seçili Dosyalar ("+a.files.length+")",children:e.jsx("div",{className:"grid grid-cols-2 gap-3 lg:grid-cols-3",children:a.files.map((s,l)=>{if(s.type.includes("image"))return e.jsx(X,{src:URL.createObjectURL(s),alt:"Resim",preview:!0,className:"w-full h-full"},l);if(s.type.includes("video"))return e.jsx("video",{src:URL.createObjectURL(s),alt:"Video",controls:!0,autoPlay:!1,className:"w-full h-full"},l)})})})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"note",className:"font-bold",children:"Sipariş Notu"}),e.jsx($,{id:"note",name:"note",value:a.note,disabled:c,placeholder:"Sipariş Notunuz.Siparişte Eksik Olan Ürünleri Stok Kodları Ve Adetleri İle Belirtiniz.",onChange:C,onBlur:B})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"name",className:"font-bold",children:["Paketi Hazırlayan Personel Seçimi ",e.jsx("span",{className:"font-semibold text-red-400",children:"*"})]}),e.jsx(E,{value:a.prepared,disabled:c,filter:!0,virtualScrollerOptions:{itemSize:43},onChange:s=>{x("prepared",s.value)},options:b,checkmark:!0,optionLabel:"name",placeholder:"Personeli Seçiniz",className:"w-full md:w-20rem"})]}),e.jsx("div",{children:e.jsx(k,{label:"Kaydet",size:"small",icon:"pi pi-save",type:"submit",disabled:c,className:"mr-2",severity:"success",loading:u})})]})})})]})})]})};export{ge as default};
