import{r as i,P as re,D as se,O as I,c as M,j as a}from"./app-MMx-yB3G.js";import{D as ie}from"./dialog.esm-BnJITAjQ.js";import{B as G}from"./button.esm-t3q6Uns9.js";import{D as oe}from"./dropdown.esm-BzwAhd2S.js";import{I as K}from"./inputtextarea.esm-c6Gr0vxJ.js";import{u as ue}from"./useSmsCounter-COrV3HUj.js";import{T as ce}from"./toast.esm-Cjq_L-3x.js";import{B as de}from"./blockui.esm-CvrtRqj0.js";import{C as me,c as U}from"./confirmpopup.esm-bTiZjuf1.js";import{A as fe,a as Y}from"./accordion.esm-Bxv35aXX.js";import{I as $}from"./inputtext.esm-BmSpreyY.js";import{C as pe,u as X,a as be,T as ye}from"./iconbase.esm-48fxaLvN.js";import{R as he}from"./ripple.esm-CDHzLfkq.js";function H(){return H=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var l=arguments[s];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(e[c]=l[c])}return e},H.apply(this,arguments)}function L(e,s){(s==null||s>e.length)&&(s=e.length);for(var l=0,c=new Array(s);l<s;l++)c[l]=e[l];return c}function ve(e){if(Array.isArray(e))return L(e)}function ge(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function q(e,s){if(e){if(typeof e=="string")return L(e,s);var l=Object.prototype.toString.call(e).slice(8,-1);if(l==="Object"&&e.constructor&&(l=e.constructor.name),l==="Map"||l==="Set")return Array.from(e);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return L(e,s)}}function xe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V(e){return ve(e)||ge(e)||q(e)||xe()}function Se(e){if(Array.isArray(e))return e}function je(e,s){var l=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(l!=null){var c,t,j,h,f=[],d=!0,u=!1;try{if(j=(l=l.call(e)).next,s===0){if(Object(l)!==l)return;d=!1}else for(;!(d=(c=j.call(l)).done)&&(f.push(c.value),f.length!==s);d=!0);}catch(w){u=!0,t=w}finally{try{if(!d&&l.return!=null&&(h=l.return(),Object(h)!==h))return}finally{if(u)throw t}}return f}}function we(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function W(e,s){return Se(e)||je(e,s)||q(e,s)||we()}var Ce={root:function(s){var l=s.props;return M("p-selectbutton p-button-group p-component",{"p-invalid":l.invalid})},button:function(s){var l=s.itemProps,c=s.focusedState;return M("p-button p-component",{"p-highlight":l.selected,"p-disabled":l.disabled,"p-focus":c})},label:"p-button-label p-c"},A=pe.extend({defaultProps:{__TYPE:"SelectButton",id:null,value:null,options:null,optionLabel:null,optionValue:null,optionDisabled:null,tabIndex:null,multiple:!1,invalid:!1,unselectable:!0,allowEmpty:!0,disabled:!1,style:null,className:null,dataKey:null,tooltip:null,tooltipOptions:null,itemTemplate:null,onChange:null,children:void 0},css:{classes:Ce}}),J=i.memo(function(e){var s=i.useState(!1),l=W(s,2),c=l[0],t=l[1],j=X(),h=e.ptm,f=e.cx,d=function(o){return h(o,{hostName:e.hostName,context:{selected:e.selected,disabled:e.disabled,option:e.option}})},u=function(o,T){e.setFocusedIndex(T),e.onClick&&e.onClick({originalEvent:o,option:e.option})},w=function(){t(!0)},N=function(){t(!1)},C=function(o,T){switch(o.code){case"Space":{u(o,T),o.preventDefault();break}case"ArrowDown":case"ArrowRight":{D(o,"next"),o.preventDefault();break}case"ArrowUp":case"ArrowLeft":{D(o,"prev"),o.preventDefault();break}}},D=function(o,T){for(var v,x,S=0;S<=e.elementRef.current.children.length-1;S++)e.elementRef.current.children[S].getAttribute("tabindex")==="0"&&(v={elem:e.elementRef.current.children[S],index:S});T==="prev"?v.index===0?x=e.elementRef.current.children.length-1:x=v.index-1:v.index===e.elementRef.current.children.length-1?x=0:x=v.index+1,e.setFocusedIndex(x),e.elementRef.current.children[x].focus()},E=function(){var o=j({className:f("label")},d("label"));return e.template?I.getJSXElement(e.template,e.option):i.createElement("span",o,e.label)},P=E(),F=j({className:M(e.className,f("button",{itemProps:e,focusedState:c})),role:"button","aria-label":e.label,"aria-pressed":e.selected,onClick:function(o){return u(o,e.index)},onKeyDown:function(o){return C(o,e.index)},tabIndex:e.tabIndex,"aria-disabled":e.disabled,onFocus:w,onBlur:N},d("button"));return i.createElement("div",F,P,!e.disabled&&i.createElement(he,null))});J.displayName="SelectButtonItem";var Q=i.memo(i.forwardRef(function(e,s){var l=X(),c=i.useContext(re),t=A.getProps(e,c),j=i.useState(0),h=W(j,2),f=h[0],d=h[1],u=i.useRef(null),w=A.setMetaData({props:t}),N=w.ptm,C=w.cx,D=w.isUnstyled;be(A.css.styles,D,{name:"selectbutton",styled:!0});var E=function(n){if(!(t.disabled||m(n.option))){var y=o(n.option);if(!(y&&!(t.unselectable&&t.allowEmpty))){var g=F(n.option),k;if(t.multiple){var B=t.value?V(t.value):[];k=y?B.filter(function(R){return!I.equals(R,g,t.dataKey)}):[].concat(V(B),[g])}else k=y?null:g;t.onChange&&t.onChange({originalEvent:n.originalEvent,value:k,stopPropagation:function(){n.originalEvent.stopPropagation()},preventDefault:function(){n.originalEvent.preventDefault()},target:{name:t.name,id:t.id,value:k}})}}},P=function(n){return t.optionLabel?I.resolveFieldData(n,t.optionLabel):n&&n.label!==void 0?n.label:n},F=function(n){return t.optionValue?I.resolveFieldData(n,t.optionValue):n&&n.value!==void 0?n.value:n},m=function(n){return t.optionDisabled?I.isFunction(t.optionDisabled)?t.optionDisabled(n):I.resolveFieldData(n,t.optionDisabled):n&&n.disabled!==void 0?n.disabled:!1},o=function(n){var y=F(n);if(t.multiple){if(t.value&&t.value.length)return t.value.some(function(g){return I.equals(g,y,t.dataKey)})}else return I.equals(t.value,y,t.dataKey);return!1},T=function(){return t.options&&t.options.length?t.options.map(function(n,y){var g=t.disabled||m(n),k=P(n),B=t.disabled||y!==f?"-1":"0",R=o(n),z=k+"_"+y;return i.createElement(J,{hostName:"SelectButton",key:z,label:k,className:n.className,option:n,setFocusedIndex:d,onClick:E,template:t.itemTemplate,selected:R,tabIndex:B,index:y,disabled:g,ptm:N,cx:C,elementRef:u})}):null};i.useImperativeHandle(s,function(){return{props:t,focus:function(){return se.focusFirstElement(u.current)},getElement:function(){return u.current}}});var v=I.isNotEmpty(t.tooltip),x=T(),S=l({ref:u,id:t.id,className:M(t.className,C("root")),style:t.style,role:"group"},A.getOtherProps(t),N("root"));return i.createElement(i.Fragment,null,i.createElement("div",S,x,t.children),v&&i.createElement(ye,H({target:u,content:t.tooltip,pt:N("tooltip")},t.tooltipOptions)))}));Q.displayName="SelectButton";const De=({csrf_token:e,initialCustomer:s=null,visible:l=!1,setVisible:c=()=>{},auth:t,initialOpened:j="sms"})=>{const h=i.useRef(null),[f,d]=i.useState(!1),u=i.useRef(null),[w,N]=i.useState([]),[C,D]=i.useState(null),{message:E,setMessage:P,smsCount:F,charCount:m}=ue(),[o,T]=i.useState(null),[v,x]=i.useState(j==="sms"?0:1),[S,O]=i.useState([{icon:"pi pi-file",label:"Dosyaya Yönlendirme",key:"file"},{icon:"pi pi-link",label:"Url Yönlendirme",key:"url"}]),[n,y]=i.useState(S[0]),[g,k]=i.useState(""),[B,R]=i.useState(""),[z,Z]=i.useState(""),ee=()=>{fetch(route("customers.getListForSms"),{method:"POST",headers:{"X-CSRF-TOKEN":e}}).then(r=>r.json()).then(({customers:r})=>{N(r)}).catch(r=>{N([])})};i.useEffect(()=>{s!==null&&D(s),ee()},[]),i.useEffect(()=>{var r;D(s!==null?s:null),l&&(["admin","salesman","engineer"].includes((r=t==null?void 0:t.user)==null?void 0:r.role)||(u.current.show({severity:"warn",summary:"Hata",detail:"Bu İşlem İçin Yetkiniz Yok"}),d(!0),setTimeout(()=>{c(!1)},100))),P("")},[l]);const _=()=>{c(!1)},te=r=>{if(C===null){u.current.show({severity:"warn",summary:"Hata",detail:"Müşteri Seçiniz",life:3e3});return}if(m===5){u.current.show({severity:"warn",summary:"Hata",detail:"Mesajınız Boş Olamaz",life:3e3});return}U({target:r.currentTarget,message:`Bu Mesaj İçin Toplam ${F} SMS Kullanılacaktır. Onaylıyor Musunuz?`,icon:"pi pi-info-circle",acceptLabel:"Gönder",acceptIcon:"pi pi-send",rejectIcon:"pi pi-times",rejectLabel:"Vazgeç",defaultFocus:"accept",accept:()=>{d(!0);let p=new FormData;p.append("customer_id",C.id),p.append("message",E),fetch(route("customers.sendMessage",`${C.id}`),{method:"POST",headers:{"X-CSRF-TOKEN":e},body:p}).then(b=>b.json()).then(b=>{b.status?(u.current.show({severity:"success",summary:"Başarılı",detail:b.message,life:3e3}),_()):u.current.show({severity:"error",summary:"Hata",detail:b.message,life:3e3})}).catch(b=>{u.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{d(!1)})}})},ne=r=>{if(g===""){u.current.show({severity:"warn",summary:"Hata",detail:"Başlık Boş Olamaz",life:3e3});return}if(B===""){u.current.show({severity:"warn",summary:"Hata",detail:"İçerik Boş Olamaz",life:3e3});return}if(n.key==="file"&&o===null){u.current.show({severity:"warn",summary:"Hata",detail:"Dosya Seçiniz",life:3e3});return}if(n.key==="url"&&z===""){u.current.show({severity:"warn",summary:"Hata",detail:"Url Boş Olamaz",life:3e3});return}U({target:r.currentTarget,message:"Bu Bildirim Gönderimi İçin Onaylıyor Musunuz?",icon:"pi pi-info-circle",acceptLabel:"Gönder",acceptIcon:"pi pi-send",rejectIcon:"pi pi-times",rejectLabel:"Vazgeç",defaultFocus:"accept",accept:()=>{d(!0);let p=new FormData;p.append("title",g),p.append("content",B),p.append("redirect_type",n.key),n.key==="file"?p.append("file",o):p.append("url",z),fetch(route("notifications.send"),{method:"POST",headers:{"X-CSRF-TOKEN":e},body:p}).then(b=>b.json()).then(b=>{b.status?(u.current.show({severity:"success",summary:"Başarılı",detail:b.message,life:3e3}),_()):u.current.show({severity:"error",summary:"Hata",detail:b.message,life:3e3})}).catch(b=>{u.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{d(!1)})}})},ae=r=>{v===0?te(r):v===1&&ne(r)},le=r=>a.jsx("div",{children:a.jsx(G,{label:f?"Gönderiliyor":"Gönder",icon:"pi pi-send",loading:f,severity:"success",size:"small",onClick:ae})});return a.jsxs(a.Fragment,{children:[a.jsx(ce,{ref:u}),a.jsx(me,{}),a.jsx(ie,{onHide:_,visible:l,style:{width:"550px"},header:"Yeni Mesaj Gönder",draggable:!0,position:"bottom-right",footer:le(),children:a.jsx(de,{blocked:f,template:a.jsx("i",{className:"pi pi-spin pi-spinner",style:{fontSize:"3rem"}}),children:a.jsxs(fe,{activeIndex:v,onTabChange:r=>{x(r.index)},children:[a.jsx(Y,{header:"SMS Gönder",children:a.jsxs("div",{className:"p-fluid",children:[a.jsxs("div",{className:"p-field mb-3",children:[a.jsx("label",{htmlFor:"name",className:"font-semibold",children:"Müşteri Seç"}),a.jsx(oe,{optionLabel:"name",filter:!0,value:C,options:w,onChange:r=>{D(r.value)},placeholder:"Müşteri Seç"})]}),a.jsxs("div",{className:"p-field",children:[a.jsxs("label",{htmlFor:"name",className:"font-semibold",children:["Mesaj [",m," Karakter / ",F," SMS]"]}),a.jsx(K,{id:"message",value:E,onChange:r=>P(r.target.value),rows:3,cols:20,autoResize:!0,placeholder:"Mesajınızı Giriniz"})]})]})}),a.jsx(Y,{header:"Bildirim Gönder",children:a.jsxs("div",{className:"p-fluid",children:[a.jsxs("div",{className:"p-field mb-3",children:[a.jsx("label",{htmlFor:"title",className:"font-semibold",children:"Başlık"}),a.jsx($,{id:"title",value:g,onChange:r=>k(r.target.value),placeholder:"Başlık Giriniz"})]}),a.jsxs("div",{className:"p-field mb-3",children:[a.jsx("label",{htmlFor:"content",className:"font-semibold",children:"İçerik"}),a.jsx(K,{id:"content",value:B,onChange:r=>R(r.target.value),rows:3,cols:20,autoResize:!0,placeholder:"Bildirim İçeriğini Giriniz"})]}),a.jsxs("div",{className:"p-field mb-3",children:[a.jsx("label",{htmlFor:"redirectType",className:"font-semibold",children:"Yönlendirme Türü"}),a.jsx(Q,{value:n,allowEmpty:!1,itemTemplate:r=>a.jsxs("span",{children:[a.jsx("i",{className:r.icon})," ",r.label]}),options:S,onChange:r=>y(r.value)})]}),(n==null?void 0:n.key)==="file"&&a.jsxs("div",{className:"p-field mb-3",children:[a.jsx("label",{htmlFor:"fileInput",className:"font-semibold",children:"Dosya Seçimi "}),a.jsx(G,{disabled:f,label:o!==null?`'${o==null?void 0:o.name}' Dosyası Seçili`:"Dosya Seç",icon:"pi pi-image",type:"button",severity:o!==null?"success":"info",onClick:()=>{h.current.click()}}),a.jsx("input",{type:"file",name:"files",id:"fileInput",onChange:r=>{let p=r.target.files[0];p&&T(p)},style:{display:"none"},ref:h}),a.jsx("small",{children:"(Seçilmesi Durumunda Bildirime Tıklandığında Dosyaya Yönlendirilir.)"})]}),(n==null?void 0:n.key)==="url"&&a.jsxs("div",{className:"p-field mb-3",children:[a.jsx("label",{htmlFor:"url",className:"font-semibold",children:"Url"}),a.jsx($,{id:"url",value:z,onChange:r=>Z(r.target.value),placeholder:"Bir URL Giriniz"}),a.jsx("small",{children:"(Gireceğiniz URL'e Yönlendirilir.)"})]})]})})]})})})]})},_e=De;export{_e as M};
