import{r as o,j as e,y as j,a as w,F as m}from"./app-MMx-yB3G.js";import{A as G}from"./AuthenticatedLayout-DqJQv-Zq.js";import{T as O}from"./toast.esm-Cjq_L-3x.js";import{D as M,C as l}from"./column.esm-BSKXtLdH.js";import{T as z}from"./toolbar.esm-Ck1JAFVg.js";import{B as u}from"./button.esm-t3q6Uns9.js";import{c as b}from"./confirmpopup.esm-bTiZjuf1.js";import{M as F}from"./MessageDialog-CK2qbNEd.js";import K from"./PreCreate-yxwUCMlY.js";import{I as L}from"./inputtext.esm-BmSpreyY.js";import{e as _}from"./helper-5dsdU7t8.js";import"./ApplicationLogo-7IUcid-B.js";import"./transition-Chc5_UKz.js";import"./iconbase.esm-48fxaLvN.js";import"./csstransition.esm-C7-qQLFH.js";import"./index.esm-B6m0rV8L.js";import"./index.esm-vUqAtpS5.js";import"./ripple.esm-CDHzLfkq.js";import"./TransitionGroup-CAdOuic2.js";import"./inputnumber.esm-JaxKPWvd.js";import"./dropdown.esm-BzwAhd2S.js";import"./virtualscroller.esm-Cs74YQWK.js";import"./overlayservice.esm-BwHVid_d.js";import"./index.esm-Bu_OTDB3.js";import"./index.esm-6wxOW2yc.js";import"./dialog.esm-BnJITAjQ.js";import"./inputtextarea.esm-c6Gr0vxJ.js";import"./useSmsCounter-COrV3HUj.js";import"./blockui.esm-CvrtRqj0.js";import"./accordion.esm-Bxv35aXX.js";import"./Update-DaL_hkzX.js";import"./formik.esm-DiYpwH7p.js";import"./inputmask.esm-Cb668VzC.js";import"./Create-DQlYeJqQ.js";const ke=({auth:y,csrf_token:c,packagesAll:A})=>{const[P,k]=o.useState(!1),[T,S]=o.useState(!1),i=o.useRef(null),[p,d]=o.useState(!0),[x,g]=o.useState([]);o.useEffect(()=>{_(c).then(t=>{t.status?g(t.data.map(a=>({...a,city_district:a.city+" / "+a.district,prepared_packer:a.prepared+" / "+a.packer}))):i.current.show({severity:"error",summary:"Hata",detail:"Paketler Getirilirken Hata Oluştu."})}).catch(t=>{console.error(t),i.current.show({severity:"error",summary:"Hata",detail:"Paketler Getirilirken Hata Oluştu."})}).finally(()=>d(!1))},[]),o.useState({});const C=({record:t})=>{const[a,r]=o.useState(t.tracking_code||""),[s,h]=o.useState(!1),N=()=>{if(a===""){i.current.show({severity:"warn",summary:"Hata",detail:"Gönderi Kodu Boş Olamaz."});return}if(a===t.tracking_code){i.current.show({severity:"info",summary:"Bilgi",detail:"Gönderi Kodu Güncellenmedi.Değişiklik Yok."});return}h(!0);let f=new FormData;f.append("tracking_code",a),fetch(route("packages.trackingCodeSetStore",t.id),{method:"POST",headers:{"X-CSRF-TOKEN":c},body:f}).then(n=>n.json()).then(n=>{n.status?(i.current.show({severity:"success",summary:"Başarılı",detail:n.message}),g(n.packages.map(v=>({...v,city_district:v.city+" / "+v.district})))):i.current.show({severity:"error",summary:"Hata",detail:n.message})}).catch(n=>{i.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{h(!1)})};return e.jsxs("div",{className:"p-inputgroup flex-1",children:[e.jsx(L,{placeholder:"Gönderi Kodu",disabled:s,value:a,onChange:f=>r(f.target.value)}),e.jsx(u,{icon:"pi pi-"+(a===t.tracking_code||a===""?"exclamation-circle":"check"),onClick:N,tooltip:"Gönderi Kodunu Güncelle",disabled:a===t.tracking_code||a==="",loading:s,severity:a===t.tracking_code||a===""?"info":"success"})]})};return e.jsxs(G,{user:y.user,header:"Gönderi Kodu Ayarla",info:[{icon:"pi-exclamation-circle",text:"Bu sayfada 'Paketlendi' statüsüne sahip olan tüm paketler ve 'Kargolandı' statüsüne sahip son 2 günlük paketler listelenmektedir."}],buttons:[{icon:"pi pi-plus",tooltip:"Yeni Paket Girişi",severity:"success",tooltipOptions:{position:"bottom"},size:"small",onClick:()=>{k(!0)},loading:p},{icon:"pi pi-search",tooltip:"Paket Sorgula",tooltipOptions:{position:"bottom"},size:"small",severity:"info",onClick:()=>{j.visit(route("sorgulama"))},loading:p},{icon:"pi pi-send",tooltip:"Yeni Mesaj Gönder",severity:"warning",tooltipOptions:{position:"bottom"},size:"small",onClick:()=>{S(!0)},loading:p}],children:[e.jsx(w,{title:"Gönderi Kodu Ayarla"}),e.jsx(O,{ref:i}),e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"max-w-[90rem] mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs(M,{value:x,removableSort:!0,paginator:!0,filterDisplay:"row",paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",rowsPerPageOptions:[5,10,25,50],rows:10,dataKey:"id",filters:{name:{value:null,matchMode:m.CONTAINS},email:{value:null,matchMode:m.CONTAINS},phone:{value:null,matchMode:m.CONTAINS},address:{value:null,matchMode:m.CONTAINS},created_at:{value:null,matchMode:m.CONTAINS},city_district:{value:null,matchMode:m.CONTAINS},status:{value:null,matchMode:m.CONTAINS}},loading:p,header:e.jsx(e.Fragment,{children:e.jsx(z,{start:()=>e.jsxs(e.Fragment,{children:[e.jsx(u,{icon:"pi pi-box",label:"Yeni Paketler",loading:p,size:"small",severity:"info",tooltip:"Yeni Paketler",tooltipOptions:{position:"top"},onClick:t=>{j.visit(route("packages.index"))},className:"mr-2"}),e.jsx(u,{icon:"pi pi-plus",label:"Yeni Paket Girişi",loading:p,size:"small",severity:"success",tooltip:"Yeni Paket Girişi",tooltipOptions:{position:"top"},onClick:t=>{k(!0)},className:"mr-2"})]})})}),emptyMessage:"Paket bulunamadı.",currentPageReportTemplate:"{first}. ile {last}. arası toplam {totalRecords} kayıttan",children:[e.jsx(l,{field:"id",header:"#",headerTooltip:"Veritabanı Kayıt Id"}),e.jsx(l,{field:"name",filter:!0,showFilterMenu:!1,filterPlaceholder:"Müşteri Adına Göre",sortable:!0,header:"Müşteri Adı"}),e.jsx(l,{field:"phone",filter:!0,showFilterMenu:!1,filterPlaceholder:"Telefon Numarasına Göre",sortable:!0,header:"Telefon Numarası"}),e.jsx(l,{field:"city_district",filter:!0,showFilterMenu:!1,filterPlaceholder:"İl/İlçe'ye Göre",sortable:!0,header:"İl/İlçe"}),e.jsx(l,{field:"status",filter:!0,showFilterMenu:!1,filterPlaceholder:"Statüye Göre",sortable:!0,header:"Durumu",body:t=>{if(t.status==="Paketlendi")return e.jsx("span",{className:"p-tag p-tag-info",children:t.status});if(t.status==="Kargolandı")return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"p-tag p-tag-success",children:t.status}),t.is_sms_sent===0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{className:"p-tag p-tag-danger",children:"Sms Gönderilemedi"})]})]})}}),e.jsx(l,{field:"tracking_code",header:"Gönderi Kodu",body:t=>e.jsx(C,{record:t})}),e.jsx(l,{field:"updated_at",filter:!0,showFilterMenu:!1,filterPlaceholder:"Güncellennme Tarihine Göre",sortable:!0,header:"Güncellenme Tarihi",body:({updated_at:t})=>new Date(t).toLocaleString()}),e.jsx(l,{header:"İşlemler",body:t=>e.jsxs("div",{className:"flex justify-center gap-x-2",children:[t.is_sms_sent===0&&t.status==="Kargolandı"&&e.jsx(u,{icon:"pi pi-send",size:"small",tooltip:"Kargo Takip Sms'i Gönder",tooltipOptions:{position:"top"},severity:"help",onClick:a=>b({target:a.currentTarget,message:"Kargo Takip Sms'i Göndermek İstediğinize Emin Misiniz?",icon:"pi pi-exclamation-triangle",acceptClassName:"p-button-help",acceptLabel:"Gönder",rejectLabel:"Vazgeç",accept:()=>{d(!0),fetch(route("packages.sendSms",t.id),{method:"POST",headers:{"X-CSRF-TOKEN":c}}).then(r=>r.json()).then(r=>{r.status?(i.current.show({severity:"success",summary:"Başarılı",detail:r.message}),g(x.map(s=>(s.id===t.id&&(s.is_sms_sent=1),s)))):i.current.show({severity:"error",summary:"Hata",detail:r.message})}).catch(r=>{i.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{d(!1)})}})}),e.jsx(u,{icon:"pi pi-trash",size:"small",tooltip:"Paket Kaydını Sil",tooltipOptions:{position:"top"},severity:"danger",onClick:a=>{let r="Paketi silmek istediğinize emin misiniz?";return t.status==="Kargolandı"&&(r="Paket kargolandığı için silmek istediğinize emin misiniz?"),b({target:a.currentTarget,message:r,icon:"pi pi-exclamation-triangle",acceptClassName:"p-button-danger",acceptLabel:"Sil",rejectLabel:"Vazgeç",accept:()=>{d(!0),fetch(route("packages.destroy",t.id),{method:"DELETE",headers:{"X-CSRF-TOKEN":c}}).then(s=>s.json()).then(s=>{s.status?(i.current.show({severity:"success",summary:"Başarılı",detail:s.message}),g(x.filter(h=>h.id!==t.id))):i.current.show({severity:"error",summary:"Hata",detail:s.message})}).catch(s=>{i.current.show({severity:"error",summary:"Hata",detail:"CSRF Token Hatası Lütfen Sayfayı Yenileyiniz.."})}).finally(()=>{d(!1)})}})}})]})})]})})})}),e.jsx(F,{csrf_token:c,visible:T,setVisible:S,auth:y}),e.jsx(K,{visible:P,auth:y,setVisible:k,csrf_token:c,toast:i,onSave:(t,a)=>{t&&j.visit(route("packages.index"))}})]})};export{ke as default};
